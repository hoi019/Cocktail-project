<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../fontawesome-free-6.4.2-web/css/all.min.css">
	<link rel="stylesheet" href="../../source/stylesheet/root.css">
	<link rel="stylesheet" href="../../source/stylesheet/admin/admin.css">

	<script src="../angular/angularjs.js"></script>
	<script src="../../source/script/admin/admin.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
		crossorigin="anonymous"></script>
	<title>Document</title>
</head>

<body ng-app="AppBanHang" ng-controller="MainCtrl">
	<section id="sidebar">
		<a href="#" class="brand">
			<img src="../images/logo.png" alt="" class="img-icon">
			<img src="../images/single-logo.png" alt="" class="single-img-icon">
		</a>
		<ul class="side-menu top">
			<li>
				<a href="./admin.html">
					<i class="fa-solid fa-user"></i>
					<span class="text">Managerment</span>
				</a>
			</li>
			<li class="active">
				<a href="./products.html">
					<i class="fa-solid fa-box"></i>
					<span class="text">Products</span>
				</a>
			</li>
			<li>
				<a href="./manafactures.html">
					<i class="fa-solid fa-industry"></i>
					<span class="text">Manafactures</span>
				</a>
			</li>
			<li>
				<a href="./customers.html">
					<i class="fa-solid fa-users"></i>
					<span class="text">Customers</span>
				</a>
			</li>
			<li>
				<a href="./bill.html">
					<i class="fa-solid fa-file-invoice"></i>
					<span class="text">Bills</span>
				</a>
			</li>
			<li>
				<a href="./receipt.html">
					<i class="fa-solid fa-file-invoice-dollar"></i>
					<span class="text">Receipts</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#">
					<i class="fa-solid fa-wrench"></i>
					<span class="text">Settings</span>
				</a>
			</li>
			<li>
				<a href="../login.html" class="logout">
					<i class="fa-solid fa-right-from-bracket"></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>

	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class="fa-solid fa-bars"></i>
			<a href="#" class="nav-link">Categories</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">8</span>
			</a>
			<a href="#" class="profile">
				<img src="../anh_nguoi.png">
			</a>
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right'></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>
				<div class="submit">
					<div class="submit__button">
						<button ng-click="Edit($x.spId)">Lưu</button>
					</div>
				</div>
				<div class="section__parents-button">
					<div class="section__button">
						<button ng-click="Add()" type="submit">{{ButtonText}}</button>
					</div>
					<!-- <div class="section__button">
						<button>Sửa</button>
					</div>
					<div class="section__button">
						<button>Xoá</button>
					</div> -->
				</div>
				<a href="#" class="btn-download">
					<i class='bx bxs-cloud-download'></i>
					<span class="text">Download PDF</span>
				</a>
			</div>

			<!-- RIGHT CONTENT -->
			<!-- ENTER CONTENT -->
			<div class="right-section">

				<!-- INPUT -->
				<div class="section-big-parents border-right">
					<div class="section__parents-label">
						<div class="section__box">
							<input id="spId" name="spId" class="section__input" type="hidden" ng-model="spId"><br>
						</div>
						<div class="section__box">
							<label for="">Nhập tên sản phẩm:</label><br>
							<input id="sTen" name="sTen" class="section__input" type="text" ng-model="sTen"><br>
						</div>
						<div class="section__box">
							<label for="">Nhập giá sản phẩm:</label><br>
							<input id="sGia" name="sGia" class="section__input" type="number" ng-model="sGia"><br>
						</div>
						<div class="section__box">
							<label for="">Nhập hình ảnh:</label><br>
							<input id="sAnh" name="sAnh" class="section__input" type="text" ng-model="sAnh"><br>
						</div>
					</div>
				</div>
				
				<!-- TABLE CONTENT -->
				<table id="table" class="table-box border-right table-content-box">
					<tr class="colum">
						<th class="colum-title one">Mã sản phẩm</th>
						<th class="colum-title">Tên sản phẩm</th>
						<th class="colum-title">Giá sản phẩm</th>
						<th class="colum-title second">Hình ảnh</th>
					</tr>
					<tr ng-repeat="x in listProduct" class="colum-content-box">
						<th class="colum-content">{{x.spId}}</th>
						<th class="colum-content">{{x.sTen}}</th>
						<th class="colum-content">{{x.sGia}}</th>
						<th class="colum-content"><img ng-src="{{'.' + x.sAnh}}" class="th-img" alt="" srcset="">
							<!-- nut Sua -->
							<i id="Edit" onclick="editClick()" class="fa-regular fa-pen-to-square"></i>
							<!-- nut Xoa -->
							<i id="Delete" ng-click="Delete(x.spId)" class="fa-solid fa-trash-can"></i>
							<!-- <i id="Update" ng-show="x.EditMode" ng-click="Update($index)" class="fa-solid fa-check"></i>
							nut V
							<i id="Cancel" ng-show="x.EditMode" ng-click="Cancel($index)" class="fa-solid fa-xmark"></i>
							nut X -->
						</th>
					</tr>

				</table>

				<div class="pagination">
					<!-- <li class="page-item previous-page"><a href="#" class="page-link">Prev</a></li>
					<li class="page-item current-page"><a href="#" class="page-link">1</a></li>
					<li class="page-item current-page"><a href="#" class="page-link">2</a></li>
					<li class="page-item current-page"><a href="#" class="page-link">3</a></li>
					<li class="page-item current-page"><a href="#" class="page-link">4</a></li>
					<li class="page-item current-page"><a href="#" class="page-link">5</a></li>
					<li class="page-item dot"><a href="#" class="page-link">...</a></li>
					<li class="page-item current-page"><a href="#" class="page-link">10</a></li>
					<li class="page-item next-page"><a href="#" class="page-link">Next</a></li> -->
				</div>
			</div>
		</main>
	</section>

	<script>
		const showEdit = () => {
			var edit = document.querySelector('.submit');
			edit.classList.toggle('show-button-edit')
		}
		const disableEdit = () => {
			var edit = document.querySelector('.submit');
			edit.classList.remove('show-button-edit')
		} 
		
		const editClick = () => {
			var table = document.getElementById('table');    
			for(var i = 1; i < table.rows.length; i++)
			{
					table.rows[i].onclick = function()
					{
								//rIndex = this.rowIndex;
								document.getElementById("sTen").value = this.cells[1].innerHTML;
								document.getElementById("sGia").value = this.cells[2].innerHTML;
								document.getElementById("sAnh").value = this.cells[3].innerHTML;
					};
			}
			showEdit();
		}

		var app = angular.module('AppBanHang', [])
		app.controller('MainCtrl', function ($scope, $http, $window) {
			$scope.ButtonText = 'Thêm';
			//Getting records from database.
			$scope.listProduct = [];

			$scope.Load = () => {
				$http({
					method: "GET",
					url: 'https://localhost:44390/api/Product/get-all',
					dataType: 'json',
					headers: { "Content-Type": "application/json" }
				}).then(function (response) {
					//The received response is saved in listProduct array.
					$scope.listProduct = response.data;
				});
			};
			$scope.Load();


			//Adding new record to database.
			$scope.Add = () => {
				const obj = {
					"sTen": $scope.sTen,
					"sGia": Number($scope.sGia),
					"sAnh": $scope.sAnh}
				$http({
					method: "POST",
					url: "https://localhost:44390/api/Product/create-product",
					data: obj,
					dataType: 'json',
					headers: { "Content-Type": "application/json" }
				}).then(function (response) {
					//The newly inserted record is inserted into the Customers array.
					$scope.listProduct.push(response.data);
					location.reload();
				}), function () {
					alert('Không thể thêm sản phẩm. Vui lòng thử lại!')
				};
				reset();
			};


			$scope.Edit = function (data) {
        console.log('update');
				var product = $scope.listProduct[index];
        $http({
					method: "PUT",
					url: "https://localhost:44390/api/Product/update-product",
					data: obj,
					dataType: 'json',
					headers: { "Content-Type": "application/json" }
        }).then(function (response) {
            alert('Bạn sửa khóa học thành công');
						$scope.listProduct[$scope.editIndex] = response.data;

						reset();

						$scope.editIndex = null;

            location.reload();
        });
				disableEdit();
    	};

			//Deleting an existing record from database.
			$scope.Delete = function (spId) {
				if ($window.confirm("Do you want to delete this row?")) {
					var obj = {
						"sTen": $scope.sTen,
						"sGia": Number($scope.sGia),
						"sAnh": $scope.sAnh};
					obj.spId = spId;
					$http({
						method: "DELETE",
						url: "https://localhost:44390/api/Product/delete-product",
						data: JSON.stringify(obj),
						dataType: 'json',
						headers: { "Content-Type": "application/json" }
					});
					post.success(function (response) {
						//Remove the Deleted record from the Customers Array.
						$scope.listProduct.splice
						
					});
					post.error(function (response, status) {
						$window.alert(data.Message);
					});
				}
			};

			$scope.reset = () => {
				$scope.sTen = "";
				$scope.sGia = "";
				$scope.sAnh = "";
			}
		});
	</script>
</body>

</html>